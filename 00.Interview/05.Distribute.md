---
title: 面试准备:分布式
date: 2018-03-20
tags:
- Java
categories:
- 面试
---
<!-- TOC -->

- [分布式原理](#分布式原理)
    - [概念](#概念)
    - [一致性 Hash](#一致性-hash)
- [分布式事务](#分布式事务)
- [分布式锁](#分布式锁)
- [分布式Session](#分布式session)
- [负载均衡](#负载均衡)
- [消息队列](#消息队列)
- [Dubbo](#dubbo)
- [微服务](#微服务)
- [QA](#qa)
- [参考](#参考)

<!-- /TOC -->

# 分布式原理

分布式:将功能拆分,分布在不同节点上
集群:不拆分功能,不同及节点上的功能是相同的

CAP原理:

1. Consistency(一致性):所有节点获取到的数据一致
2. Availability(可用性):每次请求都能提供服务,但不能保证提供的是最新数据
3. Partition tolerance(分区容错性):分布式某节点故障也能正常提供满足一致性和可用性的服务

其中P是至关重要的,否则也就没有分布的必要了,面临的也往往是C和A的取舍.另外,三选二的说法也有误导性,可[阅读][1].

BASE原理:

1. Basically Available(基本可用):允许损失部分可用性
2. Soft-state(软状态):允许降低一致性
3. Eventual Consistency(最终一致性)

主要实现是对业务数据进行拆分,如数据库服务的分库,分表等

一致性:

强一致性(即时一致性):如线程1的修改能让其他线程立刻读到.
弱一致性:如线程1的修改不用让其他线程立刻读到.
最终一致性:弱一致性情况下,线程1修改后没有被其他线程修改,那么其他线程最终都能读到线程1的修改

如何保证消息的一致性

## 概念

RT:响应时间,系统对请求作出响应的时间
Throughput:吞吐量,系统一定时间内处理请求的数量
QPS:Query Per Second,每秒查询率
并发数:系统同一时间处理的请求数

## 一致性 Hash

类似于负载均衡算法,是一种路由算法,解决的是命中问题,如存在多个缓存服务器,某次处理的应该存在哪个服务器,某次读取应该读哪个服务器等场景,
常用有取余hash,但在集群伸缩时表现不好,会造成大面积缓存击穿,增加数据库服务器的压力.

一个优秀的分布式hash算法,需要满足:

* 均衡性(Balance):hash结果均匀的分布在域上
* 单调性(Monotonicity):增减节点时,尽量避免处理某请求的节点发生改变,或尽量少的发生变化
* 分散性(Spread):处理同一用户的请求时,不会因为客户端(如IP)发生变化而改变处理的节点
* 负载(Load):

一致性hash算法:
环形Hash(hash环),可[阅读][2],[一致性Hash算法背景](https://www.cnblogs.com/lpfuture/p/5796398.html)
很好地解决了伸缩问题.

# 分布式事务

[分布式事务解决方案seata](https://github.com/seata/seata)

# 分布式锁

# 分布式Session

* 粘性session:类似Nginx的IP hash,将同一个用户的所有请求由同一个server处理,但server宕机会失去session
* 同步session:各节点间同步session,每个节点上都有一份session
* 持久化session:将session存储在缓存数据库中,如Redis,也可以存储在普通数据库中.

# 负载均衡

***CDN实现原理***

CDN(Content Delivery Network,内容分发网络),是一种Web服务加速实现.
在客户端和服务器间增加中间层CDN,引导用户访问最近最快的节点,解决网络拥塞,本质上是负载均衡实现方式的DNS重定向实现.

***怎么提升系统的QPS和吞吐量***

* 增加集群,集群中负载均衡
* 增加缓存
* 数据库分库分表
* 异步MQ

***分布式集群下如何做到唯一序列号***

[分布式系统唯一ID生成方案](https://www.cnblogs.com/haoxinyue/p/5208136.html)

***分库与分表带来的分布式困境与应对之策***

1. 联合查询中表关联问题
2. 分页,排序问题
3. 分布式事务问题
4. 数据全局唯一id问题

# 消息队列

[消息队列面试相关](https://blog.csdn.net/u014801403/article/details/80308353)

# Dubbo



# 微服务



***分布式系统怎么做服务治理***




# QA

***redis/zookeeper节点宕机如何处理***



# 参考

[1]:http://www.cnblogs.com/hxsyl/p/4381980.html
[2]:https://segmentfault.com/a/1190000013533592


