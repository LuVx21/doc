---
title: HTTPS协议
date: 2016-04-16
tags:
- HTTPS
---
<details>
<summary>点击展开目录</summary>
<!-- TOC -->

- [作用](#作用)
    - [SSL/TLS](#ssltls)
- [工作过程](#工作过程)
- [其他](#其他)

<!-- /TOC -->
</details>

## 作用

Https是身披SSL(`Secure Socket Layer`)外壳的Http, 运行于SSL上, SSL运行于TCP之上,

是添加了加密和认证机制的HTTP, 具有了加密(防窃听), 认证(防伪装)和完整性保护(防篡改)特性.

能够起到的作用:

* 验证服务方身份
* 防止数据被劫持
* 保证数据安全, 防止窃取篡改

密钥交换算法:

* RSA 算法: 浏览器生成一个密码, 然后使用证书 RSA 的公钥进行加密发给服务端, 服务再使用它的密钥进行解密得到密码, 这样就能够共享密码了
* ECDHE 算法:

### SSL/TLS

SSL: Secure Socket Layer 安全套接层

TLS: Transport Layer Security, 安全传输层, 其前身是SSL

都是在Internet上移动数据时提供身份认证和数据加密的加密协议

新版本的发布对于解决漏洞提供更强大支持和更安全的密码套件和算法

SSL2.0 和 SSL3.0 被废弃, 改用 TLS

## 工作过程

HTTPS的整体过程分为`证书验证`阶段和`数据传输`阶段, 在数据传输的加密上使用的是对称加密, 非对称加密只作用在证书验证阶段.

HTTPS协议的工作流程:

HTTPS在传输数据之前需要客户端(浏览器)与服务端(网站)之间进行一次握手, 在握手过程中将确立双方加密传输数据的密码信息.

TLS/SSL协议不仅仅是一套加密传输的协议, 其中还使用了非对称加密, 对称加密及HASH算法.

握手过程的简单描述如下:

1. 浏览器将自己支持的一套加密规则发送给网站.
2. 网站从中选出一组加密算法与HASH算法, 并将自己的身份信息以证书的形式发回给浏览器.证书里面包含了网站地址, 加密公钥, 以及证书的颁发机构等信息.
3. 获得网站证书之后浏览器要做以下工作:
    1. 验证证书的合法性(颁发证书的机构是否合法, 证书中包含的网站地址是否与正在访问的地址一致等), 如果证书受信任, 则浏览器栏里面会显示一个小锁头, 否则会给出证书不受信的提示.
    2. 如果证书受信任, 或者是用户接受了不受信的证书, 浏览器会生成一串随机数的密码, 并用证书中提供的公钥加密.
    3. 使用约定好的HASH算法计算握手消息, 并使用生成的密码对消息进行加密, 最后将之前生成的所有信息发送给网站.

4. 网站接收浏览器发来的数据之后要做以下的操作:
    1. 使用自己的私钥将信息解密取出密码, 使用密码解密浏览器发来的握手消息, 并验证HASH值是否与浏览器发来的一致.
    2. 使用密码加密一段握手消息, 发送给浏览器.

5. 浏览器解密并计算握手消息的HASH, 如果与服务端发来的HASH一致, 此时握手过程结束, 之后所有的通信数据将由之前浏览器生成的随机密码并利用对称加密算法进行加密.

这里浏览器与网站互相发送加密的握手消息并验证, 目的是为了保证双方都获得了一致的密码, 并且可以正常的加密解密数据.

其中非对称加密算法用于加密在握手过程中生成的密码, 对称加密算法用于对真正传输的数据进行加密, 而HASH算法用于验证数据的完整性.

由于浏览器生成的密码是整个数据加密的关键, 因此在传输的时候使用了非对称加密算法对其加密.

与Http存在如下不同:

* 端口不同: Http与Http使用不同的连接方式, 用的端口也不一样, 前者是`80`, 后者是`443`
* 资源消耗: 和HTTP通信相比, Https通信会由于加解密处理消耗更多的CPU和内存资源
* 开销: Https通信需要证书, 而证书一般需要向认证机构购买

> Https的加密机制是一种共享密码加密和公开密钥加密并用的混合加密机制.

## 其他

**对称加密与非对称加密**

对称密钥加密是指加密和解密使用同一个密钥的方式, 这种方式存在的最大问题就是密钥发送问题, 即如何安全地将密钥发给对方;

非对称加密是指使用一对非对称密钥, 即公钥和私钥, 公钥可以随意发布, 但私钥只有自己知道.发送密文的一方使用对方的公钥进行加密处理, 对方接收到加密信息后, 使用自己的私钥进行解密.

由于非对称加密的方式不需要发送用来解密的私钥, 所以可以保证安全性;但是和对称加密比起来, 它非常的慢, 所以还是采用对称加密来传送消息, 但对称加密所使用的密钥是通过非对称加密的方式发送出去.

**DDoS攻击**

分布式拒绝服务攻击, 三次握手的最后一次不进行(不发送确认数据)从而使服务端一直处于等待的状态.
无法彻底解决, 预防方式有以下:

* 限制同时打开SYN半链接的数目
* 缩短SYN半链接的Time out 时间
* 关闭不必要的服务

**XSS攻击**

cross site script, 跨站脚本攻击
过于信任客户端提交的数据

反射性XSS攻击:攻击者注入的数据反映在响应中
持久性XSS攻击:XSS攻击代码存储在网站数据库