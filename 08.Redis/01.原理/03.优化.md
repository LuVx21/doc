<details>
<summary>点击展开目录</summary>
<!-- TOC -->

- [内存优化](#内存优化)

<!-- /TOC -->
</details>


## 内存优化

1. 建议将字符串长度控制在39字节以下: 依据RedisObject中ptr字段特性(整数直接存储数据, 否则表示指向数据的指针, 字符串且长度<=39字节的数据, 字符串sds和redisObject一起分配内存, 只需要一次内存操作)
2. 缩减键值对象
缩减键(key)和值(value)的值压缩后再长度, 内存紧张的情况下, 可以使用通用压缩算法将value存入redis, 甚至直接存储二进制内容
3. 共享对象池
Redis内部维护`[0-9999]`的整数对象池, 当value为整数时, 会将kv的v指向同一个Redisobject, 节省内存开销.
由于指向的是同一个Redisobject, 导致LRU淘汰策略失效, 因为共享的Redisobject中的lru字段记录最后被访问时间, 该字段也是被共享的, 所以LRU无法生效.
Redis之所以只有整数对象池, 是因为在判断是否可以共享使用前需要判断value是否相等. 整数比较算法时间复杂度为O(1), 只保留一万个整数为了防止对象池浪费. 如果是字符串判断相等性, 时间复杂度变为O(n), 特别是长字符串更消耗性能(浮点数在Redis内部使用字符串存储). 其他复杂结构hash、list等, 比较算法的时间复杂度更高.
4. sds
5. 编码优化(即常用结构的底层实现优化)

不过需要注意的是: 当设置最大内存值(maxmemory)并且启用LRU相关淘汰策略(如: volatile-lru、allkeys-lru)时, 共享对象池将会被禁止使用.