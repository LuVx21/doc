---
title: vim
date: 2017-07-07
tags:
- Linux
- vim
---
<!-- TOC -->

- [自定义](#自定义)
- [设置](#设置)
- [模式](#模式)
- [0.](#0)
- [1. 插入类命令](#1-插入类命令)
- [2. 移动类命令](#2-移动类命令)
- [3. 搜索替换类命令](#3-搜索替换类命令)
- [4. 删除复制粘贴类命令](#4-删除复制粘贴类命令)
- [5. 存储退出类命令](#5-存储退出类命令)
- [6. 选择类命令](#6-选择类命令)
- [7. 多文档编辑](#7-多文档编辑)
- [8. 分屏](#8-分屏)
- [9. 执行Shell命令](#9-执行shell命令)
- [保存](#保存)

<!-- /TOC -->
## 自定义

```
# 插入模式下以`ctrl+s`保存
imap <C-s> <Esc>:w!<CR>i
```

## 设置

* `.viminfo`:保存操作历史
* `~/.vimrc`:个性化的设置

~/.vimrc 中可以设置规则:
* `set encoding=utf-8`:设置 vim 的内部编码规则为utf-8
* `set fileencodings=utf-8, gb2312`:设置 vim 怎样理解文件的编码规则

在使用 vim 打开文件后, 如果想查看文件的编码, 可使用
`:set fileencoding`

如果想更改文件的编码规则, 则可以使用
`:set fileencoding=XXX`

## 模式

末行模式 -- 命令模式 -- 编辑模式

在任何模式下`esc`都是回到命令模式.
键入`:`进入末行模式

## 0.
| 命令          | 说明                                      |
| :------------ | :---------------------------------------- |
| `ESC`         | 进入命令模式                              |
| `.`           | 重复执行前一命令                          |
| `!!`          | 重复执行前一shell命令                     |
| `{`           | 上一片代码跳转                            |
| `}`           | 下一片代码跳转                            |
| `>%`          | 从当前到匹配小(中, 大) 括号之间的文本右移 |
| `<%`          | 从当前到匹配小(中, 大) 括号之间的文本左移 |
| `:set ft=sql` | 设置新建文本类型(着色方案)                |

## 1. 插入类命令

> 可从命令模式 -->编辑模式

| 命令    | 说明                              |
| :------ | :-------------------------------- |
| `i a o` | 光标前插入 光标后插入 下行插入    |
| `I A O` | 行首插入 行尾插入 上行插入        |
| `r`     | 替换单个字符(删除 + 键入一个字符) |
| `R`     | 连续替换模式(键入覆盖后面的字符)  |

## 2. 移动类命令

**移动光标**

| 命令 | 说明                         |
| :--- | :--------------------------- |
| `k`  | ↑                            |
| `j`  | ↓                            |
| `h`  | ←                            |
| `l`  | →                            |
| `w`  | 以单词大小向后移动光标       |
| `b`  | 以单词大小向前移动光标       |
| `e`  | 以单词大小向后移动光标(词尾) |
> 上述命令前使用数字代表移动的数目

| 命令     | 说明         |
| :------- | :----------- |
| `H`      | 当前屏上部   |
| `M`      | 当前屏中部   |
| `L`      | 当前屏下部   |
| `ctrl+e` | 向下滚动一行 |
| `ctrl+y` | 向上滚动一行 |

| 命令  | 说明                               |
| :---- | :--------------------------------- |
| `0`   | 行首                               |
| `$`   | 行尾                               |
| `gg`  | 文首                               |
| `G`   | 文尾                               |
| `20G` | 到第 20 行代码(末行模式下输入行号) |

| 命令 | 说明           |
| :--- | :------------- |
| `%`  | 到配对的括号处 |

**移动屏**

| 命令     | 说明     |
| :------- | :------- |
| `ctrl+u` | 向上半屏 |
| `ctrl+d` | 向下半屏 |
| `ctrl+b` | 向上一屏 |
| `ctrl+f` | 向下一屏 |

**移动行**

| 命令        | 说明             |
| :---------- | :--------------- |
| `:2, 5 m 8` | 2~5行移动到第8行 |
| `J`         | 合并行           |


## 3. 搜索替换类命令

**查找**

| 命令    | 说明                 |
| :------ | :------------------- |
| `f F`   | 当前行内查找单个字符 |
| `t T`   | 当前行内查找单个字符 |
| `/word` | 向下查找             |
| `?word` | 向上查找             |
| `n`     | 下一个查找结果       |
| `N`     | 上一个查找结果       |

* `:set ic`:忽略大小写命令, ic 为 ignore case 缩写
* `:set is`:边输入边显示匹配结果, is 是 incsearch 命令的缩写
* `:set hls`:高亮显示匹配结果, hls 为 highlight search 缩写
> 取消上述设置在关键字前加`no`

**多文件查找**
命令模式下
`:vim`或`:vimgrep`命令执行多文件搜索

例
```
# 当前文件夹下的 php 文件和 aa 目录及子目录下的 php 文件
:vim/love/*.php aa/**/*.php
```
| 命令 | 说明         |
| :--- | :----------- |
| :cw  | 查看搜索结果 |
| :ccl | 关闭搜索结果 |
| :cn  | 查找下一个   |
| :cp  | 查找上一个   |

> ** 表示文件夹及子文件夹下的所有文件

**替换**

| 命令  | 说明             |
| :---- | :--------------- |
| `:%s` | 对所有行进行替换 |
| `g`   | 单行内所有匹配项 |
| `i`   | 忽略大小写       |
| `c`   | 确认是否替换     |

> 可以使用'+', '#'来替换'/'替换文本中的'/'

例

| 例                  | 说明                                                         |
| :------------------ | :----------------------------------------------------------- |
| `:%s/abc/123/3g`    | 替换第3个后全部abc-->123, g:替换该行全部, 数字则为替换第几个 |
| `:1, 10s/abc/123/g` | 替换1行到10行                                                |
| `:., $s/abc/123/g`  | 替换当前行到最后一行                                         |
| `:8, $s/abc/123/gc` | 替换8行到最后一行, 并且请求确认                              |

**多文件替换**

`:args`和`:argdo`命令
`args`命令为选取文件到列表
`argdo`命令为对列表中的文件执行批处理操作
这两个命令结合可以对多文件执行相同操作, 不仅是替换

| 命令                           | 说明         |
| :----------------------------- | :----------- |
| :args *.php                    | 加入参数列表 |
| :argdo %s/old/new/gc \| update | 执行替换操作 |
| :args                          | 查看参数列表 |
| :argd *                        | 清空参数列表 |
| :arga *.php                    | 加入参数列表 |

> 在执行argdo操作的时候, 要先保存当前文件, 因为批处理操作会跳到其它文件.
> 替换前要备份原先文件, update 必须加上, 系统会自动保存替换后的文件, 否则替换会中断

补充
执行`args`添加文件操作会将文件同时添加到缓冲区列表

| 命令      | 说明                                       |
| :-------- | :----------------------------------------- |
| :ls       | 列出当前缓冲区列表文件                     |
| :bd 3     | 将缓冲区3号文档删除到非缓冲区列表          |
| :ls!      | 列出非缓冲区列表文件                       |
| :bw 3     | 可将缓冲区或非缓冲区列表文件彻底清除       |
| :argdo bw | 可对参数列表中的所有文件执行清除缓冲区操作 |

## 4. 删除复制粘贴类命令

**复制**

| 命令  | 说明                     |
| :---- | :----------------------- |
| `y0`  | 复制到行首(不含当前字符) |
| `y$`  | 复制到行尾(含当前字符)   |
| `yy`  | 复制当前行               |
| `nyy` | 从当前行向下复制 n 行    |
| `ygg` | 复制当前行直到第一行     |
| `yG`  | 复制当前行直到最后一行   |

**粘贴**

| 命令 | 说明                                                   |
| :--- | :----------------------------------------------------- |
| `p`  | 粘贴, 复制了整行则在下一行粘贴, 否则在当前字符后面粘贴 |
| `P`  | 粘贴, 复制了整行则在上一行粘贴, 否则在当前字符前面粘贴 |

**修改**

| 命令 | 说明              |
| :--- | :---------------- |
| `~`  | 切换大小写        |
| `x`  | 向后删除          |
| `X`  | 向前删除          |
| `nx` | 向后删除 n 个字符 |

| 命令  | 说明                      |
| :---- | :------------------------ |
| `d0`  | 删除到行首(不含当前字符)  |
| `d$`  | 删除到行尾(含当前字符)    |
| `dd`  | 删除当前行(实际是剪切)    |
| `ndd` | 删除当前行在内的向下 n 行 |
| `dgg` | 删除当前行直到第一行      |
| `dG`  | 删除当前行直到最后一行    |

| 命令 | 说明             |
| :--- | :--------------- |
| `D`  | 删除到行尾       |
| `dw` | 删除一个单词大小 |

**撤销**

|命令|说明|
|:---|:---|
|`u`|撤销|
|`ctrl+r`|反撤销|

## 5. 存储退出类命令

命令模式下输入`:`进入末行模式

| 命令  | 说明     |
| :---- | :------- |
| `:w`  | 写入     |
| `:q`  | 退出     |
| `:wq` | 写入退出 |
上述命令使用`!`时代表强制执行

| 命令                | 说明                                         |
| :------------------ | :------------------------------------------- |
| `:w newfile`        | 另存为文件, 但是仍旧在编辑当前文件           |
| `:n1, n2 w newfile` | 把 n1 到 n2 另存到 newfile, 但仍编辑当前文件 |
| `:r filename`       | 读入 filename 中内容, 添加到当前行下面       |
| `:nr filename`      | 把《文件》插入到第 n 行                      |

> :w !sudo tee %

## 6. 选择类命令
| 命令     | 说明                                   |
| :------- | :------------------------------------- |
| `v`      | 字符选择, 会把光标所经过的字符反白选择 |
| `V`      | 行选择, 会把光标经过的行反白选择       |
| `ctrl+v` | 选择一个长方形的区域                   |

> 多行列编辑时, 修改后需按下esc两次

**选中后操作**

| 命令 | 说明                             |
| :--- | :------------------------------- |
| `y`  | 复制选择的区域                   |
| `d`  | 删除选择的区域                   |
| `r`  | 把选中区域全部字符替换为某个字符 |
| `I`  | 前面插入整列                     |
| `A`  | 后面插入整列                     |

| 命令 | 说明 |
| :--- | :--- |
| `>`  | 缩进 |
| `<`  | 缩进 |

## 7. 多文档编辑

vim 支持同时编辑多个文档
在编辑多个文档时, 多个文档之间的某些 vim 命令是共享的, 
例如在文档 1 执行了搜索, 在文档 2 中可以执行 n 继续搜索.
在文档 1 中 yy 在文档 2 中可以 p.
在文档 1 中执行了退出命令, 则两个文档都退出了.

| 命令     | 说明                                   |
| :------- | :------------------------------------- |
| `:n`     | 编辑下一个文档, 需要先保存当前编辑文档 |
| `:N`     | 编辑前一个文档                         |
| `:files` | 列出当前 vim 打开的所有文档            |

## 8. 分屏

**分屏启动 Vim**

| 命令                      | 说明        |
| :------------------------ | :---------- |
| `vim -O2 file1 file2 ...` | 垂直分 2 屏 |
| `vim -o2 file1 file2 ...` | 水平分 2 屏 |

**分屏**

|命令|说明|
|:---|:---|
|`ctrl+w s`|上下分当前文件
|`:sp [filename]`|上下分, 但会创建新文件|
|`ctrl+w v`|左右分当前文件|
|`:vsp [filename]`|左右分, 但会创建新文件|

**关闭分屏**

| 命令       | 说明                           |
| :--------- | :----------------------------- |
| `ctrl+w c` | 关闭该屏                       |
| `ctrl+w q` | 关闭该屏, 是最后一个则退出 vim |


**切换屏**

| 命令          | 说明       |
| :------------ | :--------- |
| `ctrl+w hjkl` | 上下左右个 |
| `ctrl+w w`    | 下一个     |

**移动屏**

| 命令              | 说明         |
| :---------------- | :----------- |
| `ctrl+w 大写方向` | 上下左右移动 |

**调整屏大小**

| 命令       | 说明     |
| :--------- | :------- |
| `ctrl+w =` | 所有同高 |
| `ctrl+w +` | 增加高度 |
| `ctrl+w -` | 减少高度 |

## 9. 执行Shell命令

| 命令           | 说明                                                         |
| :------------- | :----------------------------------------------------------- |
| `:! cmd`       | 暂时离开 vim 界面, 执行 cmd 命令, 退出命令之后仍然回到 vim   |
| `:r !cmd`      | 把 cmd 执行的输出, 写到当前行下面                            |
| `:m, n !cmd`   | 行m~n间的内容传入shell, 并被执行结果替换(n 可省略, `.`:当前行) |
| `:m, n w !cmd` | 同上, 但不会被执行结果替换内容                               |
| `:sh`          | 转到 shell                                                   |
| `:so filename` | 读取执行文件                                                 |

## 保存

正常退出
```
未修改->:->q
```
保存时没有权限
```
:w !sudo tee %
```

保存退出
```
:->wq->enter
:->x
shift+zz
CapsLock->ZZ
```
不保存退出
```
:->q!
```
强制退出
```
:->!
```

